{
  "$id": "https://mapcolonies.com/vector/geocoding/v1",
  "type": "object",
  "title": "vectorGeocodingSchemaV1",
  "description": "Vector's geocoding schema",
  "allOf": [
    {
      "$ref": "https://mapcolonies.com/common/boilerplate/v2"
    },
    {
      "$ref": "#/definitions/databases"
    },
    {
      "$ref": "#/definitions/appSchema"
    }
  ],
  "definitions": {
    "databases": {
      "type": "object",
      "required": ["db"],
      "properties": {
        "db": {
          "allOf": [
            {
              "type": "object",
              "required": ["redis"],
              "properties": {
                "redis": {
                  "allOf": [
                    {
                      "$ref": "https://mapcolonies.com/common/redis/v1"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "ttl": {
                          "type": "number",
                          "description": "Redis ttl in seconds",
                          "x-env-value": "REDIS_TTL"
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "type": "object",
              "required": ["s3"],
              "properties": {
                "s3": {
                  "allOf": [
                    {
                      "$ref": "https://mapcolonies.com/common/s3/full/v2"
                    },
                    {
                      "type": "object",
                      "required": ["fileName"],
                      "properties": {
                        "fileName": {
                          "type": "string",
                          "description": "Lat lon convertion table file name",
                          "x-env-value": "S3_FILE_NAME"
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "type": "object",
              "required": ["elastic"],
              "properties": {
                "elastic": {
                  "type": "object",
                  "required": ["control", "geotext"],
                  "properties": {
                    "control": {
                      "allOf": [
                        { "$ref": "https://mapcolonies.com/common/elastic/full/v2" },
                        {
                          "type": "object",
                          "properties": {
                            "node": { "type": "string", "x-env-value": "ELASTIC_CONTROL_URL" },
                            "auth": {
                              "type": "object",
                              "properties": {
                                "username": { "type": "string", "x-env-value": "ELASTIC_CONTROL_USERNAME" },
                                "password": { "type": "string", "x-env-value": "ELASTIC_CONTROL_PASSWORD" }
                              }
                            }
                          }
                        }
                      ]
                    },
                    "geotext": {
                      "allOf": [
                        {
                          "$ref": "https://mapcolonies.com/common/elastic/full/v2"
                        },
                        {
                          "type": "object",
                          "required": ["textTermLanguage"],
                          "properties": {
                            "node": { "type": "string", "x-env-value": "ELASTIC_GEOTEXT_URL" },
                            "auth": {
                              "type": "object",
                              "properties": {
                                "username": { "type": "string", "x-env-value": "ELASTIC_GEOTEXT_USERNAME" },
                                "password": { "type": "string", "x-env-value": "ELASTIC_GEOTEXT_PASSWORD" }
                              }
                            },
                            "textTermLanguage": {
                              "type": "string",
                              "description": "Elastic geotext text term language",
                              "x-env-value": "ELASTIC_GEOTEXT_TEXT_TERM_LANGUAGE"
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              }
            }
          ]
        }
      }
    },
    "appSchema": {
      "type": "object",
      "required": ["application"],
      "properties": {
        "application": {
          "description": "Application configuration",
          "type": "object",
          "required": [
            "site",
            "services",
            "cronLoadTileLatLonDataPattern",
            "elasticQueryBoosts",
            "geotextCitiesLayer",
            "roadPlaceTypes",
            "sources",
            "regions",
            "controlObjectDisplayNamePrefixes",
            "nameTranslationsKeys",
            "mainLanguageRegex"
          ],
          "properties": {
            "site": {
              "type": "string",
              "description": "The site we are currently on",
              "x-env-value": "SITE"
            },
            "services": {
              "type": "object",
              "required": ["tokenTypesUrl"],
              "properties": {
                "tokenTypesUrl": {
                  "type": "string",
                  "description": "Service url that extracts token types",
                  "x-env-value": "TOKEN_TYPE_URL"
                }
              }
            },
            "cronLoadTileLatLonDataPattern": {
              "type": "string",
              "description": "Cron for loading the tile lat lon pattern",
              "default": "0 * * * *"
            },
            "elasticQueryBoosts": {
              "$ref": "#/definitions/elasticQueryBoosts"
            },
            "geotextCitiesLayer": {
              "type": "string",
              "description": "Geotext city layer",
              "x-env-value": "GEOTEXT_CITIES_LAYER"
            },
            "roadPlaceTypes": {
              "type": "array",
              "description": "Road place types",
              "x-env-format": "json",
              "x-env-value": "GEOTEXT_ROAD_PLACETYPES"
            },
            "sources": {
              "type": "object",
              "description": "Source of the data",
              "additionalProperties": true,
              "x-env-format": "json",
              "x-env-value": "GEOTEXT_SOURCES"
            },
            "regions": {
              "type": "object",
              "description": "Data regions",
              "additionalProperties": {
                "type": "array",
                "items": { "type": "string" }
              },
              "x-env-format": "json",
              "x-env-value": "REGIONS"
            },
            "controlObjectDisplayNamePrefixes": {
              "type": "object",
              "description": "Control object display name",
              "additionalProperties": true,
              "x-env-format": "json",
              "x-env-value": "CONTROL_DISPLAY_KEY_TRANSLATIONS"
            },
            "nameTranslationsKeys": {
              "type": "array",
              "description": "Name translation keys",
              "x-env-format": "json",
              "x-env-value": "NAME_TRANSLATION_KEYS"
            },
            "mainLanguageRegex": {
              "type": "string",
              "description": "Regex of the main language",
              "x-env-value": "MAIN_LANGUAGE_REGEX"
            }
          }
        }
      }
    },
    "elasticQueryBoosts": {
      "type": "object",
      "description": "Boosts for elastic query",
      "required": ["name", "placeType", "subPlaceType", "hierarchy", "viewbox", "geotextCitiesLayer"],
      "properties": {
        "name": {
          "type": "number",
          "description": "Elastic query name boost"
        },
        "placeType": {
          "type": "number",
          "description": "Elastic query placeType boost"
        },
        "subPlaceType": {
          "type": "number",
          "description": "Elastic query subPlaceType boost"
        },
        "hierarchy": {
          "type": "number",
          "description": "Elastic query hierarchy boost"
        },
        "viewbox": {
          "type": "number",
          "description": "Elastic query viewbox boost"
        },
        "geotextCitiesLayer": {
          "type": "number",
          "description": "Elastic query geotextCitiesLayer boost"
        }
      },
      "x-env-format": "json",
      "x-env-value": "GEOTEXT_ELASTIC_QUERY_BOOSTS"
    }
  }
}

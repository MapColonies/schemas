{
  "$id": "https://mapcolonies.com/infra/jobnik/manager/v1",
  "description": "The jobnik manager service schema",
  "title": "jobnikManagerSchemaV1",
  "type": "object",
  "allOf": [
    {
      "$ref": "https://mapcolonies.com/common/boilerplate/v2"
    },
    {
      "type": "object",
      "required": ["db", "cron"],
      "properties": {
        "db": {
          "$ref": "https://mapcolonies.com/common/db/full/v2"
        },
        "cron": {
          "$ref": "#/definitions/cron"
        }
      }
    }
  ],
  "definitions": {
    "cron": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Flag to enable/disable the cron job",
          "x-env-value": "JOBNIK_CRON_ENABLED"
        },
        "schedule": {
          "type": "string",
          "description": "The cron timing spec",
          "default": "0 0 * * *",
          "pattern": "^(\\*|[0-5]?\\d|\\*/[0-5]?\\d|[0-5]?\\d-[0-5]?\\d|[0-5]?\\d-[0-5]?\\d/[0-5]?\\d|[0-5]?\\d(,[0-5]?\\d)+)\\s+(\\*|[01]?\\d|2[0-3]|\\*/([01]?\\d|2[0-3])|([01]?\\d|2[0-3])-([01]?\\d|2[0-3])|([01]?\\d|2[0-3])-([01]?\\d|2[0-3])/([01]?\\d|2[0-3])|([01]?\\d|2[0-3])(,([01]?\\d|2[0-3]))+)\\s+(\\*|0?[1-9]|[12]\\d|3[01]|\\*/(0?[1-9]|[12]\\d|3[01])|(0?[1-9]|[12]\\d|3[01])-(0?[1-9]|[12]\\d|3[01])|(0?[1-9]|[12]\\d|3[01])-(0?[1-9]|[12]\\d|3[01])/(0?[1-9]|[12]\\d|3[01])|(0?[1-9]|[12]\\d|3[01])(,(0?[1-9]|[12]\\d|3[01]))+)\\s+(\\*|0?[1-9]|1[0-2]|\\*/(0?[1-9]|1[0-2])|(0?[1-9]|1[0-2])-(0?[1-9]|1[0-2])|(0?[1-9]|1[0-2])-(0?[1-9]|1[0-2])/(0?[1-9]|1[0-2])|(0?[1-9]|1[0-2])(,(0?[1-9]|1[0-2]))+)\\s+(\\*|[0-7]|\\*/[0-7]|[0-7]-[0-7]|[0-7](,[0-7])+)$",
          "examples": ["*/1 * * * *"],
          "x-env-value": "JOBNIK_CRON_SCHEDULE"
        },
        "timeDeltaPeriodInMinutes": {
          "type": "number",
          "description": "The time delta period in minutes",
          "default": 5,
          "minimum": 1,
          "x-env-value": "JOBNIK_CRON_TIME_DELTA_PERIOD"
        }
      },
      "required": ["enabled"]
    }
  }
}

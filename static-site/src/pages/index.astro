---
// Generated by Copilot
import Layout from '@/components/Layout.astro';
import Sidebar from '@/components/Sidebar.astro';
import SearchBar from '@/components/SearchBar';
import ThemeToggle from '@/components/ThemeToggle';
import { normalizeBasePath } from '@/lib/utils';

// Get the base path with trailing slash
const base = normalizeBasePath(import.meta.env.BASE_URL || '/');

// Load schema data at build time
let schemaData;
try {
  schemaData = await import('../../public/data/schemas.json');
} catch (error) {
  console.warn('Schema data not found. Run npm run build:data first.');
  schemaData = { schemas: [], categories: [] };
}

const totalSchemas = schemaData.schemas.length;
const categories = schemaData.categories;
---

<Layout title="MapColonies Schemas">
  <!-- Header -->
  <header class="border-b sticky top-0 z-50 bg-background">
    <div class="flex items-center justify-between px-4 py-3">
      <a href={base} class="text-xl font-bold hover:underline"> MapColonies Schemas </a>
      <div class="flex items-center gap-4">
        <SearchBar client:load />
        <ThemeToggle client:load />
      </div>
    </div>
  </header>

  <!-- Main content with sidebar -->
  <div class="flex h-[calc(100vh-57px)]">
    <Sidebar />
    <main class="flex-1 p-6 overflow-y-auto">
      <div class="container mx-auto max-w-6xl">
        <h1 class="text-4xl font-bold mb-4">MapColonies Schema Documentation</h1>
        <p class="text-xl text-muted-foreground mb-8">
          Browse and explore {totalSchemas} configuration schemas
        </p>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-8">
          {
            categories.map((cat: any) => (
              <div class="border rounded-lg p-6 bg-card hover:shadow-md transition-shadow">
                <h3 class="text-lg font-semibold capitalize mb-2">{cat.name}</h3>
                <p class="text-3xl font-bold mb-2">{cat.count}</p>
                <p class="text-sm text-muted-foreground mb-4">{cat.count === 1 ? 'schema' : 'schemas'}</p>
                <a href={`${base}category/${cat.name}`} class="text-blue-600 hover:underline text-sm font-medium">
                  View all ‚Üí
                </a>
              </div>
            ))
          }
        </div>

        <!-- Quick Start Section -->
        <div class="mt-12 border rounded-lg p-6 bg-card">
          <h2 class="text-2xl font-bold mb-4">Getting Started</h2>
          <p class="text-muted-foreground mb-4">
            This site provides comprehensive documentation for all MapColonies JSON schemas. Use the sidebar to browse schemas by category, or use the
            search bar to find specific schemas.
          </p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
            <div>
              <h3 class="font-semibold mb-2">üìö Browse by Category</h3>
              <p class="text-sm text-muted-foreground">
                Schemas are organized into categories like common, infra, and vector. Click on any category to see all related schemas.
              </p>
            </div>
            <div>
              <h3 class="font-semibold mb-2">üîç Search</h3>
              <p class="text-sm text-muted-foreground">Use the search bar (Cmd/Ctrl + K) to quickly find schemas by name or description.</p>
            </div>
            <div>
              <h3 class="font-semibold mb-2">üîó View Dependencies</h3>
              <p class="text-sm text-muted-foreground">
                Each schema page shows its dependencies and what schemas reference it. View the full dependency graph to understand relationships.
              </p>
            </div>
            <div>
              <h3 class="font-semibold mb-2">‚öôÔ∏è Default Configs</h3>
              <p class="text-sm text-muted-foreground">Many schemas include default configuration examples that you can copy and use.</p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</Layout>
